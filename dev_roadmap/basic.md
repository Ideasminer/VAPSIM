# 基本思路

> author: 陈嘉毅
>
> date: 2020 - 12 - 19

## 需求剖析

* 构建一个Valet Parking代客泊车停车场的仿真环境，为之后的规划问题求解提供数据接口和方法接口
  * 规划问题所需要的部分
    * 关键变量
      * 车位/汽车的基本尺寸$(x,y)$
      * 栈堆$i$的容量$X_i$
      * 一个停车区域有几个栈堆$Y_i$
      * 一个停车场有几个停车区域$i$
      * 停车区域是竖向布置还是横向布置
      * 相邻停车区域之间的两类过道的尺寸
        * 临时停放车道$G_i$条数
        * 通过性车道$E_i$条数
      * 疏散通道（出入停车场）车道尺寸$O_i$
    * 计算方法
      * 容量和密度
      * 期望调车次数
        * 需要到达-离去的分布，停车需求
        * 需要上述关键变量：$X_i$,$Y_i$,$(x,y)$,$G_i$,$E_i$
      * 期望阻隔次数
        * 待更新

## 组织方法

### 设施

* Spot（车位）

  * 编号$k$
  * 位置
  * 占用状况（1/0)

  * 边界：四个角点
  * 大小
  * （方向）：都是沿X轴方向布置，横向，省略

* Stack（K栈堆）:: Spot

  * 继承
    * 编号$j$
    * 位置
    * 占用状况
    * 边界
    * 大小
  * 拓展
    * 容量大小$X_i$:容纳Spot的数量
    * 车位列表[]Spot：所包含的Spot

* Area（停车区）:: Stack

  * 继承
    * 编号$i$
    * 位置
    * 占用状况
    * 边界
    * 大小
    * 容量大小$Y_i$
    * 栈堆列表[]Stack：所包含的Stack

* Lot（停车场）（无继承）

  * 占用状况
  * 停车区信息
    * 张量：$(n, i, j)$：有几个停车区，每个停车区有几个栈堆，每个栈堆有几个停车位，三维。

  * 停车区信息的$(n, i, j)$可以直接查找到对应的停车位、栈堆、停车区（通过编号）
  * 过道信息
    * $E_i$和$G_i$的数量，张量。
  * 出入车道信息
    * 车道数量$O_i$
  * 布置方向
    * 横向布置停车区还是竖向布置停车区

### 规划问题调用的方法

* 规划问题只需要基本的数据大小：已经满足，直接获取各个类别的成员变量即可
* 规划方案自动的调整：根据规划问题当前求解的结果，自动向Lot中传值（决策变量+控制变量），得到停车区信息、过道信息和出入车道信息、布置方向，对于停车区，建立函数，参数为Lot的对象，根据Lot对象包含的参数，进行自动创建、初始化。
* 在外部创建函数，计算期望调车次数（Lot，需求分配矩阵）
  * Lot包含设施设计的决策变量
  * 需求分配矩阵是Demand的决策变量
  * 返回是期望调车次数
  * 根据返回值更新Lot和需求分配矩阵，不断迭代收敛

